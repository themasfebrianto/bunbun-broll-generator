@namespace BunbunBroll.Components.Forms
@using BunbunBroll.Components.Common

<div class="@GetContainerClasses()">
    <button type="button"
            role="switch"
            aria-checked="@IsChecked"
            class="@GetSwitchClasses()"
            disabled="@Disabled"
            @onclick="Toggle">
        <span class="@GetThumbClasses()"></span>
    </button>
    
    @if (!string.IsNullOrEmpty(Label))
    {
        <label class="text-sm font-medium leading-none cursor-pointer" @onclick="Toggle">
            @Label
        </label>
    }
</div>

@if (!string.IsNullOrEmpty(Description))
{
    <p class="text-xs text-muted-foreground mt-1 ml-11">@Description</p>
}

@code {
    [Parameter] public string? Label { get; set; }
    [Parameter] public string? Description { get; set; }
    [Parameter] public bool IsChecked { get; set; }
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public EventCallback<bool> IsCheckedChanged { get; set; }
    [Parameter(CaptureUnmatchedValues = true)] public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private async Task Toggle()
    {
        if (Disabled) return;
        
        IsChecked = !IsChecked;
        await IsCheckedChanged.InvokeAsync(IsChecked);
    }

    private string GetContainerClasses() => "flex items-center gap-3";

    private string GetSwitchClasses()
    {
        var classes = new List<string> 
        { 
            "peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
        };
        
        if (IsChecked)
            classes.Add("bg-primary");
        else
            classes.Add("bg-input");
        
        return string.Join(" ", classes);
    }

    private string GetThumbClasses()
    {
        var classes = new List<string> 
        { 
            "pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform"
        };
        
        if (IsChecked)
            classes.Add("translate-x-4");
        else
            classes.Add("translate-x-0");
        
        return string.Join(" ", classes);
    }
}
