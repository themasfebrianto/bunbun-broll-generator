@namespace BunbunBroll.Components.Forms
@using BunbunBroll.Components.Common
@inherits InputBase<string?>

<FormField Label="@Label" 
           For="@ElementId" 
           Description="@Description" 
           Error="@GetErrorMessage()"
           Required="@Required"
           Size="@Size">
    <input id="@ElementId"
           type="@GetInputType()"
           class="@GetInputClasses()"
           placeholder="@Placeholder"
           disabled="@Disabled"
           readonly="@ReadOnly"
           @bind="@CurrentValue"
           @attributes="AdditionalAttributes" />
</FormField>

@code {
    [Parameter] public string? Label { get; set; }
    [Parameter] public string? Description { get; set; }
    [Parameter] public string? Placeholder { get; set; }
    [Parameter] public string Type { get; set; } = "text"; // text, password, email, number, url, tel
    [Parameter] public string Size { get; set; } = "default"; // default, sm
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public bool ReadOnly { get; set; }
    [Parameter] public bool Required { get; set; }

    private string ElementId { get; } = $"input-{Guid.NewGuid():N}";

    protected override bool TryParseValueFromString(string? value, out string? result, out string validationErrorMessage)
    {
        result = value;
        validationErrorMessage = "";
        return true;
    }

    private string GetInputType() => Type.ToLowerInvariant() switch
    {
        "password" => "password",
        "email" => "email",
        "number" => "number",
        "url" => "url",
        "tel" => "tel",
        "search" => "search",
        _ => "text"
    };

    private string GetInputClasses()
    {
        var classes = new List<string> { "w-full rounded-lg border bg-transparent transition-colors duration-150 placeholder:text-muted-foreground hover:border-foreground/30 focus:outline-none focus:border-foreground disabled:cursor-not-allowed disabled:opacity-50" };
        
        // Size
        classes.Add(Size.ToLowerInvariant() switch
        {
            "sm" => "h-8 px-3 text-sm",
            _ => "h-10 px-3 py-2 text-sm"
        });
        
        // Validation state
        if (EditContext?.GetValidationMessages(FieldIdentifier).Any() == true)
        {
            classes.Add("border-destructive");
        }
        else
        {
            classes.Add("border-border");
        }
        
        return string.Join(" ", classes);
    }

    private string? GetErrorMessage()
    {
        if (EditContext == null) return null;
        return EditContext.GetValidationMessages(FieldIdentifier).FirstOrDefault();
    }
}
