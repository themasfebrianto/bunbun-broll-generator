@using BunbunBroll.Models

<div class="space-y-4">
    <!-- Duration Slider -->
    <div class="space-y-2">
        <div class="flex justify-between items-center">
            <label class="text-sm font-medium leading-none">Target Duration</label>
            <span class="text-sm font-mono text-muted-foreground">@TargetDuration s</span>
        </div>
        <input type="range" 
               min="15" max="60" step="5"
               value="@TargetDuration"
               @onchange="OnDurationChange"
               class="w-full h-2 bg-muted rounded-lg appearance-none cursor-pointer accent-foreground" />
        <div class="flex justify-between text-[10px] text-muted-foreground">
            <span>15s</span>
            <span>30s</span>
            <span>45s</span>
            <span>60s</span>
        </div>
    </div>

    <!-- Options Grid -->
    <div class="grid grid-cols-2 gap-3">
        <!-- Auto Cut -->
        <div class="flex items-center space-x-2">
            <button type="button" 
                    role="switch"
                    aria-checked="@AutoCut"
                    class="peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors @(AutoCut ? "bg-primary" : "bg-input")"
                    @onclick="() => ToggleOption(ref _autoCut)">
                <span class="pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform @(AutoCut ? "translate-x-4" : "translate-x-0")"></span>
            </button>
            <label class="text-sm font-medium leading-none">Auto Cut</label>
        </div>

        <!-- Transitions -->
        <div class="flex items-center space-x-2">
            <button type="button" 
                    role="switch"
                    aria-checked="@AddTransitions"
                    class="peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors @(AddTransitions ? "bg-primary" : "bg-input")"
                    @onclick="() => ToggleOption(ref _addTransitions)">
                <span class="pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform @(AddTransitions ? "translate-x-4" : "translate-x-0")"></span>
            </button>
            <label class="text-sm font-medium leading-none">Transitions</label>
        </div>

        <!-- Text Overlay -->
        <div class="flex items-center space-x-2">
            <button type="button" 
                    role="switch"
                    aria-checked="@AddTextOverlay"
                    class="peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors @(AddTextOverlay ? "bg-primary" : "bg-input")"
                    @onclick="() => ToggleOption(ref _addTextOverlay)">
                <span class="pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform @(AddTextOverlay ? "translate-x-4" : "translate-x-0")"></span>
            </button>
            <label class="text-sm font-medium leading-none">Text Overlay</label>
        </div>

        <!-- Background Music -->
        <div class="flex items-center space-x-2">
            <button type="button" 
                    role="switch"
                    aria-checked="@AddBackgroundMusic"
                    class="peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors @(AddBackgroundMusic ? "bg-primary" : "bg-input")"
                    @onclick="() => ToggleOption(ref _addBackgroundMusic)">
                <span class="pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform @(AddBackgroundMusic ? "translate-x-4" : "translate-x-0")"></span>
            </button>
            <label class="text-sm font-medium leading-none">Background Music</label>
        </div>
    </div>

    <!-- Hook Text (Optional) -->
    @if (AddTextOverlay)
    {
        <div class="space-y-2">
            <label class="text-sm font-medium leading-none">Hook Text (Opening)</label>
            <input type="text" 
                   class="input"
                   @bind="HookText" 
                   @bind:event="oninput"
                   placeholder="e.g. Tahukah kamu? ðŸ¤”" />
            <p class="text-xs text-muted-foreground">Displayed at the start of the video for 2 seconds.</p>
        </div>
    }
</div>

@code {
    private bool _autoCut = true;
    private bool _addTransitions = true;
    private bool _addTextOverlay = true;
    private bool _addBackgroundMusic = false;

    [Parameter]
    public int TargetDuration { get; set; } = 30;

    [Parameter]
    public EventCallback<int> TargetDurationChanged { get; set; }

    [Parameter]
    public bool AutoCut
    {
        get => _autoCut;
        set => _autoCut = value;
    }

    [Parameter]
    public EventCallback<bool> AutoCutChanged { get; set; }

    [Parameter]
    public bool AddTransitions
    {
        get => _addTransitions;
        set => _addTransitions = value;
    }

    [Parameter]
    public EventCallback<bool> AddTransitionsChanged { get; set; }

    [Parameter]
    public bool AddTextOverlay
    {
        get => _addTextOverlay;
        set => _addTextOverlay = value;
    }

    [Parameter]
    public EventCallback<bool> AddTextOverlayChanged { get; set; }

    [Parameter]
    public bool AddBackgroundMusic
    {
        get => _addBackgroundMusic;
        set => _addBackgroundMusic = value;
    }

    [Parameter]
    public EventCallback<bool> AddBackgroundMusicChanged { get; set; }

    [Parameter]
    public string HookText { get; set; } = "";

    [Parameter]
    public EventCallback<string> HookTextChanged { get; set; }

    private void OnDurationChange(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out var duration))
        {
            TargetDuration = duration;
            TargetDurationChanged.InvokeAsync(duration);
        }
    }

    private void ToggleOption(ref bool option)
    {
        option = !option;
        StateHasChanged();

        // Notify parent of changes
        if (option == _autoCut) AutoCutChanged.InvokeAsync(_autoCut);
        else if (option == _addTransitions) AddTransitionsChanged.InvokeAsync(_addTransitions);
        else if (option == _addTextOverlay) AddTextOverlayChanged.InvokeAsync(_addTextOverlay);
        else if (option == _addBackgroundMusic) AddBackgroundMusicChanged.InvokeAsync(_addBackgroundMusic);
    }
}
