@inherits LayoutComponentBase
@inject NavigationManager NavigationManager
@inject BunbunBroll.Services.ILlmRouterService RouterService
@inject BunbunBroll.Services.ToastService ToastService
@implements IDisposable

<AuthGuard>
    <div class="min-h-screen flex w-full bg-background text-foreground">
        <!-- Main Content Area -->
        <div class="flex flex-1 flex-col w-full min-w-0">
            <!-- Top Header -->
            <header class="flex h-14 items-center gap-4 border-b border-border bg-card shadow-sm px-4 justify-between">
                <a href="/" class="flex items-center gap-2 font-semibold text-lg text-primary hover:text-primary/90 transition-colors">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                        <polyline points="14 2 14 8 20 8"/>
                    </svg>
                    <span>Bunbun</span>
                </a>
                <div class="flex items-center gap-4">
                    <a href="/" class="text-sm font-medium text-muted-foreground hover:text-foreground transition-colors">Dashboard</a>
                    <a href="/projects" class="text-sm font-medium text-muted-foreground hover:text-foreground transition-colors">Projects</a>
                    <a href="/video" class="text-sm font-medium text-muted-foreground hover:text-foreground transition-colors">Video</a>
                    <ThemeToggle />
                    <SignOutButton />
                </div>
            </header>

            <main class="flex-1 overflow-y-auto w-full">
                <div class="container mx-auto max-w-7xl pt-4 lg:pt-6">
                    @Body
                </div>
            </main>
        </div>

        <!-- Toast Notifications -->
        <Toast />
    </div>
</AuthGuard>

@code {
    protected override void OnInitialized()
    {
        RouterService.OnModelSwitched += HandleModelSwitched;
    }

    private void HandleModelSwitched(string message)
    {
        InvokeAsync(() => 
        {
            // Use Warning toast since model rotations usually indicate a rate limit or failover
            ToastService.ShowWarning(message);
            StateHasChanged();
        });
    }

    public void Dispose()
    {
        RouterService.OnModelSwitched -= HandleModelSwitched;
    }
}
